## Проектирование базы данных

Процесс проектирования базы данных начался с анализа трёх исходных файлов: `Tovar.xlsx`, `user_import.xlsx` и `Заказ_import.xlsx`. Подробный анализ нормализации данных с пошаговым приведением к третьей нормальной форме документирован в файле `Приведение_к_нормальной_форме.docx`. В ходе работы исходные Excel-файлы были модифицированы с созданием промежуточных таблиц для наглядного представления процесса нормализации.

## Инструменты разработки

Проект создавался в **SQL Server Management Studio** и **Visual Studio**. SSMS использовался для работы с базой данных, а Visual Studio — для написания кода приложений.

## Структура репозитория

### Файлы базы данных

#### SQL-скрипты
- **`01_Create_Database.sql`** - создаёт новую базу данных с именем `ShoeStoreDb`
- **`02_Fix_Schema.sql`** - основной скрипт конфигурации базы данных, который:
  - Исправляет ошибочные данные
  - Настраивает автоматическую генерацию идентификаторов
  - Устанавливает связи между таблицами через внешние ключи
  - Определяет типы данных и обязательные поля

#### CSV файлы с данными
- **`Categories.csv`** - содержит категории товаров для классификации продукции
- **`Suppliers.csv`** - включает информацию о компаниях-поставщиках
- **`Manufacturers.csv`** - список фирм-производителей обуви
- **`Products.csv`** - основной каталог товаров с детальной информацией
- **`Roles.csv`** - определяет роли пользователей в системе
- **`Users.csv`** - содержит учетные записи пользователей
- **`Customers.csv`** - список клиентов магазина
- **`Orders.csv`** - хранит информацию о совершенных заказах
- **`OrderItems.csv`** - детализированный состав каждого заказа

#### Диаграмма
- **`ER_диаграмма.png`** - графическое представление структуры базы данных в виде Entity-Relationship диаграммы

## Основное решение и проекты

Решение Visual Studio под названием **`ShoeStoreSolution`** включает четыре взаимосвязанных проекта, каждый из которых выполняет определённую роль в архитектуре системы.

### Библиотека классов ShoeStoreData
Служит фундаментом всего решения, содержит модели данных, контекст базы данных и общую бизнес-логику, реализованные с использованием **Entity Framework Core** для ORM-маппинга.

**Модели данных и их использование в заданиях:**

#### Основные модели сущностей:
- `Category` - категории товаров (используется в заданиях 1, 4, 6)
- `Supplier` - поставщики товаров (используется в заданиях 1, 4, 6)
- `Manufacturer` - производители обуви (используется в заданиях 1, 4, 6)
- `Role` - роли пользователей (используется в заданиях 1, 3, 5, 6)
- `User` - пользователи системы (используется в заданиях 1, 3, 5, 6)
- `Customer` - клиенты магазина (используется в заданиях 1, 5)
- `Order` - заказы (используется в заданиях 1, 3, 5)
- `OrderItem` - позиции заказов (используется в заданиях 1, 5)
- `Product` - товары (используется во ВСЕХ заданиях 1-6)

#### Вспомогательные классы:
- `ShoeStoreDbContext` - контекст базы данных для Entity Framework (используется во всех заданиях 2-6)
- `LoginRequest` - DTO для передачи данных авторизации (используется в заданиях 3 и 6)
- `AuthOptions` - настройки JWT аутентификации (используется только в задании 3)

### Веб-API проект ShoeStoreAPI
Предоставляет **RESTful интерфейс** для взаимодействия с системой через HTTP-запросы. **Используется в задании 3.**

**Контроллеры:**
- `AuthController` - управление **авторизацией** с использованием JWT-токенов
- `ProductsController` - операции с товарами (CRUD)
- `OrdersController` - работа с заказами
- `TestController` - тестовый контроллер для проверки работы API

**Дополнительные классы:**
- `OrderUpdateDto` - DTO для обновления заказов

**Используемые модели:** `Product`, `Order`, `User`, `Role`, `LoginRequest`, `OrderUpdateDto`

### Веб-приложение ShoeStoreWeb
Построенное на технологии **Razor Pages**, представляет собой пользовательский интерфейс для клиентов магазина. **Используется в заданиях 4 и 5.**

**Страницы:**
- `Products/Index` - главная страница с каталогом товаров (задание 4)
- `Account/Login` - страница авторизации пользователей (задание 5)
- `Account/Logout` - обработка выхода из системы (задание 5)
- `Orders/Index` - просмотр заказов (задание 5)

**Используемые модели:**
- **Задание 4:** `Product`, `Manufacturer`, `Category`, `Supplier`
- **Задание 5:** `Product`, `Order`, `OrderItem`, `User`, `Customer`

### Оконное приложение ShoeStoreDesktop
Разработанное на платформе **WPF**, предназначено для администраторов и менеджеров магазина. **Используется в задании 6.**

**Окна:**
- `LoginWindow` - окно авторизации
- `MainWindow` - главное окно с каталогом товаров
- `AddEditProductWindow` - окно добавления/редактирования товаров
- `DeleteProductsWindow` - окно подтверждения удаления товаров
- `SelectProductsWindow` - окно выбора товаров для операций
- `OrdersWindow` - окно просмотра заказов

**Конвертеры (Converters):**
- `StringToImageConverter` - преобразование пути к изображению в BitmapImage
- `PriceDisplayConverter` - форматирование отображения цен
- `QuantityToTextConverter` - преобразование количества в текстовый статус
- `DiscountToBackgroundConverter` - установка фона в зависимости от скидки
- `DiscountToForegroundConverter` - установка цвета текста в зависимости от скидки
- `DiscountToTextConverter` - форматирование текста скидки
- `DiscountLabelConverter` - преобразование скидки в текстовую метку
- `IntToVisibilityConverter` - преобразование числа в видимость элемента
- `IntToInverseVisibilityConverter` - обратное преобразование видимости
- `QuantityToBackgroundConverter` - установка фона в зависимости от наличия товара

**Используемые модели:** Все модели сущностей из `ShoeStoreData.Models`, а также `LoginRequest` для авторизации.

## Архитектура системы

Все три клиентских приложения зависят от библиотеки классов `ShoeStoreData`, что обеспечивает единообразие доступа к данным и исключает дублирование кода, создавая целостную модульную архитектуру системы.

## Выполнение заданий

### Задание 1. Разработка базы данных
**Выполнено полностью**
- Проведена нормализация до 3NF
- Созданы все необходимые таблицы
- Реализованы первичные и внешние ключи
- Использованы оптимальные типы данных
- Настроены автоинкрементные значения
- Сохранена ER-диаграмма в формате PNG
- Все данные экспортированы в CSV

**Используемые модели:** Все модели сущностей из `ShoeStoreData.Models`

### Задание 2. Создание решения и библиотеки классов
**Выполнено полностью**
- Создано решение с 4 проектами
- Реализована библиотека классов с контекстом данных
- Использован Entity Framework Core для ORM
- Добавлены необходимые DTO
- Библиотека используется во всех клиентских приложениях

**Используемые компоненты:** Все модели, контекст и DTO из `ShoeStoreData`

### Задание 3. Создание веб-API
**Выполнено полностью**
- Реализована **авторизация по логину и паролю с использованием JWT токенов** (`AuthOptions` и `LoginRequest`)
- Созданы контроллеры для товаров (`ProductsController`) и заказов (`OrdersController`)
- Настроена ролевая авторизация на основе модели `Role`
- Реализован доступ к заказам по логину пользователя (модель `User`)
- Добавлена возможность изменения статуса заказа через `OrderUpdateDto`

**Используемые модели:** `Product`, `Order`, `User`, `Role`, `LoginRequest`, `OrderUpdateDto`, `AuthOptions`

### Задание 4. Просмотр списка товаров в веб-приложении
**Выполнено полностью**
- Отображение товаров с фотографиями (используется модель `Product`)
- Все виды фильтрации: по описанию, производителю (`Manufacturer`), цене
- Отображение товаров только со скидкой
- Отображение товаров только в наличии
- Все виды сортировки по названию, поставщику (`Supplier`), цене
- Отображение цены после применения скидки
- Отображение связанных данных через модели `Category`, `Supplier`, `Manufacturer`

**Используемые модели:** `Product`, `Manufacturer`, `Category`, `Supplier`

### Задание 5. Работа с заказами в веб-приложении
**Выполнено полностью**
- Авторизация пользователей (модель `User`)
- Отображение ФИО пользователя
- Создание новых заказов для клиентов (модели `Order`, `OrderItem`, `Customer`)
- Раздельный просмотр заказов по ролям
- Автоматическое заполнение данных заказа:
  - Дата заказа - текущая дата
  - Дата доставки - через неделю
  - Код получения - случайное число 100-999
  - Статус - "Новый"

**Используемые модели:** `Product`, `Order`, `OrderItem`, `User`, `Customer`

### Задание 6. Работа с товарами в оконном приложении
**Выполнено полностью**
- Окно авторизации при запуске с использованием `LoginRequest`
- Просмотр товаров с фильтрацией и сортировкой
- Визуальное выделение с помощью конвертеров:
  - Товаров со скидкой (красная основная цена)
  - Отсутствующих товаров (голубой фон строки)
- Управление товарами для ролей Менеджер и Администратор (модель `Role`):
  - Добавление новых товаров
  - Редактирование существующих товаров
  - Удаление выбранных товаров
  - Загрузка/замена изображений товаров
- Обновление данных после модификации товаров
- Просмотр заказов в отдельном окне

**Используемые модели:** Все модели сущностей из `ShoeStoreData.Models`, `LoginRequest`, все конвертеры

## Порядок развертывания системы

1. **Установка базы данных:**
   - Выполнить `01_Create_Database.sql` в SQL Server
   - Выполнить `02_Fix_Schema.sql`
   - Импортировать данные из CSV файлов в правильной последовательности

2. **Настройка подключения:**
   - Проверить строку подключения в `ShoeStoreDbContext`
   - При необходимости обновить параметры подключения

3. **Запуск приложений:**
   - Веб-API: запустить проект `ShoeStoreAPI`
   - Веб-приложение: запустить проект `ShoeStoreWeb`
   - Оконное приложение: запустить проект `ShoeStoreDesktop`

## Демонстрационные данные для тестирования

После развертывания системы для тестирования можно использовать следующие учетные записи из файла `Users.csv`:

**Администратор (полный доступ ко всем функциям):**
- Логин: 94d5ous@gmail.com
- Пароль: uzWC67
- Применение: тестирование всех функций в веб-приложении и оконном приложении

**Менеджер (управление товарами и заказами):**
- Логин: 1diph5e@tutanota.com
- Пароль: 8ntwUp
- Применение: тестирование функций управления товарами в оконном приложении (задание 6)

**Клиент (покупка товаров):**
- Логин: 5d4zbu@tutanota.com
- Пароль: rwVDh9
- Применение: тестирование оформления заказов в веб-приложении (задания 4 и 5)

**Примечание по ролям в системе:** 
В заданиях 3, 5 и 6 указаны следующие требования:
- "Редактирование товаров и изменение статуса и даты доставки заказа должны быть доступны для авторизованных пользователей с ролью **администратор или менеджер**" (задание 3)
- "После авторизации пользователям становится доступен переход к странице «Заказы»: клиент может увидеть список своих заказов в виде таблицы, **менеджер и администратор** могут увидеть список всех заказов в виде таблицы" (задание 5)
- "Пользователи с ролью **менеджер и администратор** имеют возможность перехода к окну добавления нового товара или редактирования выбранного" (задание 6)

В соответствии с этими формулировками, роли **Администратор** и **Менеджер** имеют одинаковые права доступа в системе. Такое решение соответствует требованиям технического задания.

## Особенности реализации

### Соблюдение требований к стилю
- Использован шрифт Times New Roman
- Основной фон: #FFFFFF (белый)
- Дополнительный фон: #7FFF00
- Акцентирование внимания: #00FA9A
- Для скидки более 15%: фон #2E8B57
- Установлен логотип и иконка на всех формах

### Безопасность
- JWT авторизация в API с использованием `AuthOptions`
- Ролевая модель доступа на основе модели `Role`
- Проверка прав доступа для операций в соответствии с ролью

### Обработка данных
- Валидация входных данных на стороне клиента и сервера
- Обработка исключительных ситуаций с информативными сообщениями

## Примечания

Все задания выполнены в полном объеме. Система готова к использованию и проверке. 

**Комментарии в коде:** в соответствии с требованиями задания, все разработанные методы содержат комментарии, объясняющие работу кода. Комментарии добавлены ко всем ключевым методам в контроллерах API, обработчикам событий в WPF и Razor Pages, конвертерам и другим важным компонентам системы.

**Использование компонентов по заданиям:**
- **Модели сущностей** (`Product`, `Order`, `User` и др.) используются во всех соответствующих заданиях
- **Контекст базы данных** (`ShoeStoreDbContext`) используется во всех заданиях кроме первого
- **DTO** (`LoginRequest`, `OrderUpdateDto`) используются в API и WPF приложениях
- **Конвертеры** используются только в WPF приложении для визуального оформления
- **Настройки авторизации** (`AuthOptions`) используются только в веб-API
