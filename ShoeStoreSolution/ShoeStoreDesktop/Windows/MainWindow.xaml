<Window x:Class="ShoeStoreDesktop.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:ShoeStoreDesktop"
        xmlns:converters="clr-namespace:ShoeStoreDesktop.Converters"
        Title="Магазин обуви - Каталог товаров" 
        Height="700" 
        Width="1200"
        WindowStartupLocation="CenterScreen"
        Icon="/Icon.ico">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Border Style="{StaticResource SecondaryHeader}" Grid.Row="0">
            <DockPanel>
                <Border Width="40" 
                        Height="40" 
                        Background="#7FFF00"
                        DockPanel.Dock="Left"
                        Margin="10,0,10,0"
                        CornerRadius="5"
                        BorderBrush="#00FA9A"
                        BorderThickness="2">
                    <Image Source="/Icon.ico" 
                           Width="24" 
                           Height="24"
                           VerticalAlignment="Center" 
                           HorizontalAlignment="Center"/>
                </Border>

                <TextBlock Text="Магазин обуви - Каталог товаров" 
                           FontSize="18" 
                           FontWeight="Bold"
                           VerticalAlignment="Center"
                           DockPanel.Dock="Left"
                           Foreground="#2E8B57"/>

                <StackPanel Orientation="Horizontal" 
                            HorizontalAlignment="Right"
                            DockPanel.Dock="Right"
                            Margin="0,0,10,0">
                    <TextBlock x:Name="UserInfoTextBlock" 
                               VerticalAlignment="Center"
                               Margin="0,0,20,0"
                               FontWeight="SemiBold"
                               FontSize="14"/>

                    <Button x:Name="ViewOrdersButton" 
                            Content="Заказы" 
                            Click="ViewOrdersButton_Click"
                            Style="{StaticResource AccentButton}"
                            Width="100"
                            Margin="0,0,10,0"/>

                    <Button x:Name="LogoutButton" 
                            Content="Выйти" 
                            Click="LogoutButton_Click"
                            Style="{StaticResource AccentButton}"
                            Width="80"/>
                </StackPanel>
            </DockPanel>
        </Border>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Border Style="{StaticResource SecondaryPanel}" Grid.Column="0">
                <StackPanel>
                    <Border Width="60" 
                            Height="60" 
                            Background="#7FFF00"
                            HorizontalAlignment="Center"
                            Margin="0,0,0,10"
                            CornerRadius="5"
                            BorderBrush="#00FA9A"
                            BorderThickness="2">
                        <Image Source="/Icon.ico" 
                               Width="36" 
                               Height="36"
                               VerticalAlignment="Center" 
                           HorizontalAlignment="Center"/>
                    </Border>

                    <TextBlock Text="Фильтры и поиск" 
                               Style="{StaticResource WindowTitle}"/>

                    <Label Content="Поиск по описании"/>
                    <TextBox x:Name="SearchTextBox" 
                             TextChanged="FilterTextBox_TextChanged"/>

                    <Label Content="Производитель:"/>
                    <ComboBox x:Name="ManufacturerComboBox" 
                              DisplayMemberPath="Name"
                              SelectedValuePath="ManufacturerId"
                              SelectionChanged="ComboBox_SelectionChanged"/>

                    <Label Content="Макс. цена:"/>
                    <TextBox x:Name="MaxPriceTextBox" 
                             PreviewTextInput="NumberValidationTextBox"
                             TextChanged="FilterTextBox_TextChanged"/>

                    <CheckBox x:Name="OnlyDiscountCheckBox" 
                              Content="Только со скидкой"
                              Margin="0,10,0,5"
                              Checked="FilterCheckBox_Changed"
                              Unchecked="FilterCheckBox_Changed"/>

                    <CheckBox x:Name="OnlyInStockCheckBox" 
                              Content="Только в наличии"
                              Margin="0,0,0,10"
                              Checked="FilterCheckBox_Changed"
                              Unchecked="FilterCheckBox_Changed"/>

                    <Label Content="Сортировка:"/>
                    <ComboBox x:Name="SortComboBox" 
                              SelectionChanged="ComboBox_SelectionChanged">
                        <ComboBoxItem Content="По названию" Tag="name"/>
                        <ComboBoxItem Content="По поставщику" Tag="supplier"/>
                        <ComboBoxItem Content="По цене (возр.)" Tag="price"/>
                        <ComboBoxItem Content="По цене (убыв.)" Tag="price_desc"/>
                    </ComboBox>

                    <Button x:Name="ResetFiltersButton" 
                            Content="Сбросить фильтры" 
                            Click="ResetFiltersButton_Click"
                            Style="{StaticResource AccentButton}"
                            Margin="0,20,0,0"/>

                    <StackPanel x:Name="AdminControlsPanel" 
                                Visibility="Collapsed"
                                Margin="0,20,0,0">
                        <TextBlock Text="Управление товарами:" 
                                   FontWeight="Bold"
                                   Margin="0,0,0,5"
                                   Foreground="#2E8B57"/>

                        <Button x:Name="AddProductButton" 
                                Content="Добавить товар" 
                                Style="{StaticResource AccentButton}"
                                Click="AddProductButton_Click"
                                Margin="0,0,0,5"/>

                        <Button x:Name="EditProductButton" 
                                Content="Изменить товар" 
                                Style="{StaticResource AccentButton}"
                                Click="EditProductButton_Click"
                                Margin="0,0,0,5"/>

                        <Button x:Name="DeleteProductButton" 
                                Content="Удалить выбранные" 
                                Background="#FFCCCC"
                                Foreground="#CC0000"
                                BorderBrush="#FF9999"
                                FontWeight="Bold"
                                Click="DeleteProductButton_Click"
                                Margin="0,0,0,5"/>
                    </StackPanel>
                </StackPanel>
            </Border>

            <ScrollViewer Grid.Column="1" 
                          VerticalScrollBarVisibility="Auto"
                          Margin="10">
                <ItemsControl x:Name="ProductsItemsControl">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Margin="0,0,0,15"
                                    BorderBrush="#00FA9A"
                                    BorderThickness="2"
                                    CornerRadius="5"
                                    Padding="10">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="Background" Value="#FFFFFF"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Quantity}" Value="0">
                                                <Setter Property="Background" Value="#E8F4FF"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>

                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <Grid Grid.Row="0" Margin="0,0,0,10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="2*"/>
                                            <ColumnDefinition Width="0.5*"/>
                                        </Grid.ColumnDefinitions>

                                        <Border Grid.Column="0"
                                                Margin="5"
                                                Background="#F8FFF0"
                                                BorderBrush="#7FFF00"
                                                BorderThickness="1"
                                                CornerRadius="4">
                                            <Grid Width="150" Height="150">
                                                <Image Source="{Binding Photo, Converter={StaticResource StringToImageConverter}, Mode=OneWay}"
                                                       Width="140"
                                                       Height="140"
                                                       Stretch="Uniform"
                                                       VerticalAlignment="Center"
                                                       HorizontalAlignment="Center">
                                                    <Image.Style>
                                                        <Style TargetType="Image">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding Photo}" Value="{x:Null}">
                                                                    <Setter Property="Source">
                                                                        <Setter.Value>
                                                                            <BitmapImage UriSource="pack://application:,,,/Icon.ico"/>
                                                                        </Setter.Value>
                                                                    </Setter>
                                                                    <Setter Property="Opacity" Value="0.3"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding Photo}" Value="">
                                                                    <Setter Property="Source">
                                                                        <Setter.Value>
                                                                            <BitmapImage UriSource="pack://application:,,,/Icon.ico"/>
                                                                        </Setter.Value>
                                                                    </Setter>
                                                                    <Setter Property="Opacity" Value="0.3"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Image.Style>
                                                </Image>
                                            </Grid>
                                        </Border>

                                        <Border Grid.Column="1"
                                                Margin="5"
                                                Background="#FFFFFF"
                                                BorderBrush="#7FFF00"
                                                BorderThickness="1"
                                                CornerRadius="4"
                                                Padding="10">
                                            <StackPanel>
                                                <WrapPanel Margin="0,0,0,5">
                                                    <TextBlock Text="Категория товара: " 
                                                               FontWeight="Bold"/>
                                                    <TextBlock Text="{Binding Category.Name}"/>
                                                    <TextBlock Text=" | " Margin="5,0"/>
                                                    <TextBlock Text="Наименование товара: " 
                                                               FontWeight="Bold"/>
                                                    <TextBlock Text="{Binding Name}" 
                                                               FontWeight="Bold"
                                                               Foreground="#2E8B57"/>
                                                </WrapPanel>

                                                <TextBlock Margin="0,0,0,5">
                                                    <Run Text="Описание товара: " FontWeight="Bold"/>
                                                    <Run Text="{Binding Description}"/>
                                                </TextBlock>

                                                <TextBlock Margin="0,0,0,5">
                                                    <Run Text="Производитель: " FontWeight="Bold"/>
                                                    <Run Text="{Binding Manufacturer.Name}"/>
                                                </TextBlock>

                                                <TextBlock Margin="0,0,0,5">
                                                    <Run Text="Поставщик: " FontWeight="Bold"/>
                                                    <Run Text="{Binding Supplier.Name}"/>
                                                </TextBlock>

                                                <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                                    <TextBlock Text="Цена: " FontWeight="Bold" Margin="0,0,5,0"/>
                                                    <ContentControl Content="{Binding Converter={StaticResource PriceDisplayConverter}}"/>
                                                </StackPanel>

                                                <TextBlock Margin="0,0,0,5">
                                                    <Run Text="Единица измерения: " FontWeight="Bold"/>
                                                    <Run Text="{Binding Unit}"/>
                                                </TextBlock>

                                                <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                                    <TextBlock Text="Количество на складе: " FontWeight="Bold"/>

                                                    <Border Background="{Binding Quantity, Converter={StaticResource QuantityToBackgroundConverter}, Mode=OneWay}"
                                                            CornerRadius="3"
                                                            Padding="5,2"
                                                            Margin="5,0,0,0">
                                                        <StackPanel Orientation="Horizontal">
                                                            <TextBlock Text="{Binding Quantity, StringFormat={}{0} шт., Mode=OneWay}"
                                                                       FontWeight="Bold">
                                                                <TextBlock.Style>
                                                                    <Style TargetType="TextBlock">
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding Quantity}" Value="0">
                                                                                <Setter Property="Foreground" Value="#FF6666"/>
                                                                            </DataTrigger>
                                                                            <DataTrigger Binding="{Binding Quantity}">
                                                                                <Setter Property="Foreground" Value="#2E8B57"/>
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </TextBlock.Style>
                                                            </TextBlock>

                                                            <TextBlock Text=" (" 
                                                                       Foreground="#666666"/>

                                                            <TextBlock Text="{Binding Quantity, Converter={StaticResource QuantityToTextConverter}, Mode=OneWay}"
                                                                       FontSize="11"
                                                                       FontWeight="Bold"/>

                                                            <TextBlock Text=")" 
                                                                       Foreground="#666666"/>
                                                        </StackPanel>
                                                    </Border>
                                                </StackPanel>
                                            </StackPanel>
                                        </Border>

                                        <Border Grid.Column="2"
                                                Margin="5"
                                                Background="{Binding Discount, Converter={StaticResource DiscountToBackgroundConverter}, Mode=OneWay}"
                                                BorderBrush="#7FFF00"
                                                BorderThickness="1"
                                                CornerRadius="4">
                                            <StackPanel VerticalAlignment="Center"
                                                        HorizontalAlignment="Center">
                                                <TextBlock Text="{Binding Discount, Converter={StaticResource DiscountToTextConverter}, Mode=OneWay}"
                                                           FontSize="24"
                                                           FontWeight="Bold"
                                                           HorizontalAlignment="Center"
                                                           Foreground="{Binding Discount, Converter={StaticResource DiscountToForegroundConverter}, Mode=OneWay}"/>

                                                <TextBlock Text="{Binding Discount, Converter={StaticResource DiscountLabelConverter}, Mode=OneWay}"
                                                           FontSize="11"
                                                           HorizontalAlignment="Center"
                                                           Margin="0,5,0,0"
                                                           Foreground="{Binding Discount, Converter={StaticResource DiscountToForegroundConverter}, Mode=OneWay}"/>
                                            </StackPanel>
                                        </Border>
                                    </Grid>

                                    <Border Grid.Row="1"
                                            BorderBrush="#7FFF00"
                                            BorderThickness="0,1,0,0"
                                            Padding="0,10,0,0">
                                        <StackPanel HorizontalAlignment="Center">
                                            <Button Content="Заказать"
                                                    Width="100"
                                                    Click="OrderButton_Click"
                                                    Tag="{Binding Article}">
                                                <Button.Style>
                                                    <Style TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
                                                        <Setter Property="Background" Value="#00FA9A"/>
                                                        <Setter Property="Foreground" Value="#000000"/>
                                                        <Setter Property="BorderBrush" Value="#00CD8B"/>
                                                        <Setter Property="BorderThickness" Value="2"/>
                                                        <Setter Property="FontWeight" Value="Bold"/>
                                                        <Setter Property="Padding" Value="10,5"/>
                                                        <Setter Property="Cursor" Value="Hand"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Quantity}" Value="0">
                                                                <Setter Property="IsEnabled" Value="False"/>
                                                                <Setter Property="Background" Value="#CCCCCC"/>
                                                                <Setter Property="Foreground" Value="#666666"/>
                                                                <Setter Property="BorderBrush" Value="#AAAAAA"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Button.Style>
                                            </Button>
                                        </StackPanel>
                                    </Border>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>

                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Vertical"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>
            </ScrollViewer>
        </Grid>

        <StatusBar Grid.Row="2" Background="#F8FFF0">
            <StatusBarItem>
                <TextBlock x:Name="StatusTextBlock" Text="Готово"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="ProductsCountTextBlock" Text="Товаров: 0"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>